<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>멤버 목록</title>
    <link href="/css/modal.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
            crossorigin="anonymous"></script>
    <script
            src="https://code.jquery.com/jquery-3.7.1.js"
            integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
            crossorigin="anonymous">
    </script>
    <script src="/js/modal.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">


    <script>
        $(document).ready(function () {
            alert(document.cookie);
            $.loadData();

            // '새 멤버 추가' 버튼 클릭 시 모달 열기
            $('#showAddModalButton').click(function () {
                $('#modal_box_add').fadeIn(400); // 부드럽게 나타남
                $('.modal_bg').fadeIn(400);
            });

            // 모달 닫기 버튼 클릭 시 모달 닫기
            $('.modalCloseButton').click(function () {
                $('#modal_box_add').fadeOut(200); // 부드럽게 사라짐
                $('.modal_bg').fadeOut(200);
            });
        });

        // 데이터 목록 로드
        $.loadData = () => {
            $.ajax({
                url: '/swimPool/list',
                method: 'GET'
            }).done(function (data, textStatus, jqXHR) {
                console.log("Success:", data.responseData);
                $.printList(data.responseData);

                $('#memberCount').text(data.responseData ? data.responseData.length : 0);
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error("Error:", textStatus, errorThrown);
                alert("멤버 목록을 불러오는데 실패했습니다.");
            });
        }
        $.printList = function (data) {
            $("#listData").empty(); // 기존 목록 비우기
            if (data && data.length > 0) {


                for (let i = 0; i < data.length; i++) {

                    let swimPoolDto = data[i];
                    let one = `<div class="list-group-item list-group-item-action d-flex flex-column align-items-start py-3" onclick="$.getOne(${swimPoolDto.id});">
                                    <h6 class="mb-1">이름: ${swimPoolDto.name}</h6>
                                    <small class="text-muted">라인수: ${swimPoolDto.ranes || 'N/A'}</small>
                                    <small class="text-muted">풀 길이: ${swimPoolDto.raneType || 'N/A'}</small>
                                    </div>`;
                    $("#listData").append(one);

                }


            } else {
                $("#listData").append('<div class="alert alert-info text-center" role="alert">등록된 멤버가 없습니다.</div>');
            }
        }

        // 새 멤버 추가 (INSERT)
        $.insert = function () {
            let dataMember = {
                "name": $("#name").val(),
                "ranes": $("#ranes").val(),
                "raneType": $("#raneType").val(),
                "phoneNumber": $("#phoneNumber").val(),
                "addr": $("#addr").val()
            };

            // 간단한 클라이언트 측 유효성 검사
            if (!dataMember.name || !dataMember.ranes || !dataMember.phoneNumber) {
                alert("이름, 라인수, 전화번호는 필수 입력 항목입니다.");
                return;
            }

            $.ajax({
                url: '/swimPool/insert',
                type: "POST",
                data: JSON.stringify(dataMember),

                dataType: "JSON", // 'datatype' -> 'dataType' 수정
                contentType: 'application/json',
            }).done(function (data, textStatus, jqXHR) {
                console.log("Success:", data.responseData);
                alert("멤버가 성공적으로 추가되었습니다!");
                $.loadData(); // 목록 새로고침
                $.clearInputForm(); // 입력 폼 초기화
                $(".modalCloseButton").trigger("click"); // 모달 닫기
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error("Error:", textStatus, errorThrown);
                alert("멤버 추가에 실패했습니다. " + (jqXHR.responseJSON ? jqXHR.responseJSON.message : "알 수 없는 오류"));
            });
        };

        // 입력 폼 초기화
        $.clearInputForm = () => {
            $("#name").val("");
            $("#ranes").val("");
            $("#raneType").val("");
            $("#phoneNumber").val("");
            $("#addr").val("");
        }

        // 상세 보기/수정 폼 초기화
        $.clearViewForm = () => {
            $("#viewId").val(""); // ID도 초기화
            $("#viewName").val("");
            $("#viewRanes").val("");
            $("#viewRaneType").val("");
            $("#viewPhoneNumber").val("");
            $("#viewAddr").val("");
        }

        // 특정 멤버 정보 가져오기 (GET ONE)
        $.getOne = function (id) {
            $.ajax({
                url: '/swimPool/getone?id=' + id,
                method: 'GET'
            }).done(function (data, textStatus, jqXHR) {
                console.log("Success:", data.responseData);
                $.printOne(data.responseData);
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error("Error:", textStatus, errorThrown);
                alert("멤버 정보를 불러오는데 실패했습니다.");
            });
        };


        // 상세 보기 폼에 데이터 출력
        $.printOne = function (pool) {
            if (pool == null || pool == undefined) {
                $.clearViewForm(); // 데이터 없으면 폼 초기화
                alert("선택된 멤버 정보가 없습니다.");
                return;
            }
            $("#viewId").val(pool.id);
            $("#viewName").val(pool.name);
            $("#viewRanes").val(pool.ranes);
            $("#viewRaneType").val(pool.raneType);
            $("#viewPhoneNumber").val(pool.phoneNumber);
            $("#viewAddr").val(pool.addr);
        }


        // 멤버 정보 수정 (UPDATE)
        $.update = function () {
            let requestJson = {
                id: Number($("#viewId").val()),
                // 서버 DTO 필드명에 맞게 수정: viewName -> name, viewRanes -> ranes 등
                name: $("#viewName").val(),
                ranes: $("#viewRanes").val(),
                raneType: $("#viewRaneType").val(),
                phoneNumber: $("#viewPhoneNumber").val(),
                addr: $("#viewAddr").val()
            };

            // 필수 유효성 검사
            if (!requestJson.id) {
                alert("수정할 멤버를 선택해주세요.");
                return;
            }
            if (!requestJson.name || !requestJson.ranes || !requestJson.phoneNumber) {
                alert("이름, 라인수, 전화번호는 필수 입력 항목입니다.");
                return;
            }

            $.ajax({
                url: '/swimPool/update',
                type: "PATCH",
                data: JSON.stringify(requestJson),
                dataType: "JSON", // 'datatype' -> 'dataType' 수정
                contentType: 'application/json',
            }).done(function (data, textStatus, jqXHR) {
                console.log("Success:", data.responseData);
                alert("멤버 정보가 성공적으로 수정되었습니다!");
                $.loadData(); // 목록 새로고침
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error("Error:", textStatus, errorThrown);
                alert("멤버 정보 수정에 실패했습니다. " + (jqXHR.responseJSON ? jqXHR.responseJSON.message : "알 수 없는 오류"));
            });
        }

        // 멤버 삭제 (DELETE)
        $.delete = function () {
            let memberId = Number($("#viewId").val());

            if (!memberId) {
                alert("삭제할 멤버를 선택해주세요.");
                return;
            }

            if (!confirm("정말로 이 멤버를 삭제하시겠습니까?")) {
                return;
            }

            $.ajax({
                url: '/swimPool/delete',
                type: "DELETE",
                data: JSON.stringify({id: memberId}),
                dataType: "JSON", //
                contentType: 'application/json',
            }).done(function (data, textStatus, jqXHR) {
                console.log("Success:", data.responseData);
                alert("멤버가 성공적으로 삭제되었습니다!");
                $.loadData();
                $.clearViewForm();
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error("Error:", textStatus, errorThrown);
                alert("멤버 삭제에 실패했습니다. " + (jqXHR.responseJSON ? jqXHR.responseJSON.message : "알 수 없는 오류"));
            });
        }
    </script>
</head>
<body class="bg-light">
<div class="container py-5"><h1 class="text-center mb-5 display-4 text-primary"> 수영장️</h1>
    <div class="row g-4">
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">등록된 멤버 목록</h5>
                    <span class="badge bg-secondary rounded-pill fs-6" id="memberCount">0</span></div>
                <div class="card-body overflow-auto" style="max-height: 500px;">
                    <div id="listData" class="list-group">
                    </div>
                </div>
                <div class="card-footer text-center">
                    <button id="showAddModalButton" class="btn btn-success btn-lg w-100">
                        <i class="bi bi-plus-circle"></i> 새 멤버 추가
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">멤버 상세 정보 / 수정</h5>
                </div>
                <div class="card-body">
                    <form><input type="hidden" id="viewId"/>
                        <div class="mb-3">
                            <label for="viewName" class="form-label">이름</label>
                            <input type="text" id="viewName" class="form-control" placeholder="이름을 입력하세요">
                        </div>
                        <div class="mb-3">
                            <label for="viewRanes" class="form-label">라인수</label>
                            <input type="text" id="viewRanes" class="form-control" placeholder="라인수를 입력하세요">
                        </div>
                        <div class="mb-3">
                            <label for="viewRaneType" class="form-label">라인 종류</label>
                            <input type="text" id="viewRaneType" class="form-control" placeholder="라인 종류를 입력하세요">
                        </div>
                        <div class="mb-3">
                            <label for="viewPhoneNumber" class="form-label">전화 번호</label>
                            <input type="text" id="viewPhoneNumber" class="form-control" placeholder="전화번호를 입력하세요">
                        </div>
                        <div class="mb-3">
                            <label for="viewAddr" class="form-label">주소</label>
                            <input type="text" id="viewAddr" class="form-control" placeholder="주소를 입력하세요">
                        </div>
                        <div class="d-flex justify-content-end gap-2 mt-4">
                            <button type="button" onclick="$.update();" class="btn btn-primary">
                                <i class="bi bi-pencil-square"></i> 수정확인
                            </button>
                            <button type="button" onclick="$.delete();" class="btn btn-danger">
                                <i class="bi bi-trash"></i> 삭제버튼
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>
    <div id="modal_box_add" class="modal" tabindex="-1" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">새 멤버 추가</h5>
                    <button type="button" class="btn-close modalCloseButton" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="name" class="form-label">이름</label>
                            <input type="text" id="name" name="name" maxlength="100" class="form-control"
                                   placeholder="이름을 입력하세요">
                        </div>
                        <div class="mb-3">
                            <label for="ranes" class="form-label">라인수</label>
                            <input type="text" id="ranes" name="ranes" maxlength="100" class="form-control"
                                   placeholder="라인수를 입력하세요">
                        </div>
                        <div class="mb-3">
                            <label for="raneType" class="form-label">라인 종류</label>
                            <input type="text" id="raneType" name="raneType" maxlength="100" class="form-control"
                                   placeholder="라인 종류를 입력하세요">
                        </div>
                        <div class="mb-3">
                            <label for="phoneNumber" class="form-label">전화 번호</label>
                            <input type="text" id="phoneNumber" name="phoneNumber" maxlength="100" class="form-control"
                                   placeholder="전화번호를 입력하세요">
                        </div>
                        <div class="mb-3">
                            <label for="addr" class="form-label">주소</label>
                            <input type="text" id="addr" name="addr" maxlength="100" class="form-control"
                                   placeholder="주소를 입력하세요">
                        </div>
                    </form>
                </div>


                <div class="modal-footer">
                    <button type="button" onclick="$.insert();" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> 추가
                    </button>
                    <button type="button" class="btn btn-secondary modalCloseButton">
                        <i class="bi bi-x-circle"></i> 닫기
                    </button>
                </div>
            </div>
        </div>


    </div>
    <div class="modal_bg" style="display: none"></div>
</div>
</body>
</html>